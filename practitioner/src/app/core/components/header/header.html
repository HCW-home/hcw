<header class="header">
  <div class="header-left">
    <div class="page-info">
      <app-typography [variant]="TypographyTypeEnum['h4-bold']" color="var(--slate-800)">
        {{ pageTitle() }}
      </app-typography>
      <app-typography [variant]="TypographyTypeEnum['body-s-regular']" color="var(--slate-500)">
        {{ pageSubtitle() }}
      </app-typography>
    </div>
  </div>

  <div class="header-actions">
    @if (showNewConsultationButton()) {
      <button class="new-consultation-btn" (click)="navigateToNewConsultation()">
        <app-svg src="plus" [svgStyle]="{'width.px': 16, 'height.px': 16, 'color': 'var(--White)'}"></app-svg>
        <span>New Consultation</span>
      </button>
    }

    <app-language-selector></app-language-selector>

    <div class="notification-section">
      <button class="notification-btn" (click)="toggleNotifications()">
        <app-svg src="bell" [svgStyle]="{'width.px': 22, 'height.px': 22, 'color': 'var(--slate-600)'}"></app-svg>
        @if (notificationService.unreadCount() > 0) {
          <span class="notification-badge">{{ notificationService.unreadCount() > 9 ? '9+' : notificationService.unreadCount() }}</span>
        }
      </button>

      @if (showNotifications()) {
        <div class="notification-dropdown">
          <div class="dropdown-header">
            <app-typography [variant]="TypographyTypeEnum['body-bold']" color="var(--slate-800)">
              Notifications
            </app-typography>
            @if (notificationService.unreadCount() > 0) {
              <button class="mark-all-read" (click)="markAllNotificationsRead()">
                Mark all read
              </button>
            }
          </div>
          <div class="notification-list">
            @if (notificationService.isLoading()) {
              <div class="notification-loading">
                <app-typography [variant]="TypographyTypeEnum['body-s-regular']" color="var(--slate-500)">
                  Loading...
                </app-typography>
              </div>
            } @else if (notificationService.notifications().length === 0) {
              <div class="notification-empty">
                <app-svg src="bell" [svgStyle]="{'width.px': 32, 'height.px': 32, 'color': 'var(--slate-300)'}"></app-svg>
                <app-typography [variant]="TypographyTypeEnum['body-s-regular']" color="var(--slate-400)">
                  No notifications
                </app-typography>
              </div>
            } @else {
              @for (notification of notificationService.notifications(); track notification.id) {
                <div
                  class="notification-item"
                  [ngClass]="{'unread': isNotificationUnread(notification)}"
                  (click)="onNotificationClick(notification)">
                  <div class="notification-indicator" [ngClass]="{'visible': isNotificationUnread(notification)}"></div>
                  <div class="notification-content">
                    <app-typography [variant]="TypographyTypeEnum['body-semibold']" color="var(--slate-800)">
                      {{ notification.subject }}
                    </app-typography>
                    <app-typography [variant]="TypographyTypeEnum['body-s-regular']" color="var(--slate-500)">
                      {{ notification.content }}
                    </app-typography>
                    <app-typography [variant]="TypographyTypeEnum['body-xs-regular']" color="var(--slate-400)">
                      {{ notificationService.getRelativeTime(notification.created_at) }}
                    </app-typography>
                  </div>
                </div>
              }
            }
          </div>
        </div>
      }
    </div>

    <div class="profile-section" (click)="toggleProfileMenu()">
      <div class="profile-info">
        <app-typography [variant]="TypographyTypeEnum['body-semibold']" color="var(--slate-800)">
          {{ getUserDisplayName() }}
        </app-typography>
      </div>
      <div class="profile-avatar">
        <span>{{ getUserInitials() }}</span>
      </div>
      <app-svg
        src="svg/chevron-down.svg"
        [svgStyle]="{'width.px': 16, 'height.px': 16, 'color': 'var(--slate-400)'}"
        [ngClass]="{'rotated': showProfileMenu()}">
      </app-svg>
    </div>

    @if (showProfileMenu()) {
      <div class="profile-dropdown">
        <div class="dropdown-header">
          <app-typography [variant]="TypographyTypeEnum['body-bold']" color="var(--slate-800)">
            {{ getUserDisplayName() }}
          </app-typography>
          <app-typography [variant]="TypographyTypeEnum['body-s-regular']" color="var(--slate-500)">
            {{ currentUser?.email }}
          </app-typography>
        </div>
        <div class="dropdown-items">
          <button class="dropdown-item" (click)="openProfile()">
            <app-svg src="svg/profile.svg" [svgStyle]="{'width.px': 18, 'height.px': 18, 'color': 'var(--slate-500)'}"></app-svg>
            <app-typography [variant]="TypographyTypeEnum['body-regular']" color="var(--slate-700)">
              My Profile
            </app-typography>
          </button>
          <button class="dropdown-item logout" (click)="onLogout()">
            <app-svg src="svg/log-out.svg" [svgStyle]="{'width.px': 18, 'height.px': 18, 'color': 'var(--rose-500)'}"></app-svg>
            <app-typography [variant]="TypographyTypeEnum['body-medium']" color="var(--rose-500)">
              Sign out
            </app-typography>
          </button>
        </div>
      </div>
    }
  </div>
</header>

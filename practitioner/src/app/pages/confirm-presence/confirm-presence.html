<div class="presence-page">
  <div class="presence-container">

    @if (isLoading) {
      <div class="loading-state">
        <app-loader></app-loader>
        <app-typography
          [variant]="TypographyTypeEnum['body-medium']"
          color="var(--slate-500)">
          {{ 'confirmPresence.loadingAppointments' | translate }}
        </app-typography>
      </div>
    } @else if (errorMessage) {
      <div class="error-state">
        <app-svg
          src="error"
          [svgStyle]="{ 'width.px': 48, 'height.px': 48, color: 'var(--error-500)' }">
        </app-svg>
        <app-typography
          [variant]="TypographyTypeEnum['h6-semibold']"
          color="var(--error-600)">
          {{ 'confirmPresence.error' | translate }}
        </app-typography>
        <app-typography
          [variant]="TypographyTypeEnum['body-regular']"
          color="var(--slate-500)">
          {{ errorMessage }}
        </app-typography>
        <app-button
          [block]="true"
          [style]="ButtonStyleEnum.primary"
          [text]="'confirmPresence.goToDashboard' | translate"
          (buttonClick)="goToHome()">
        </app-button>
      </div>
    } @else if (pendingAppointments.length === 0) {
      <div class="empty-state">
        <app-svg
          src="approve"
          [svgStyle]="{ 'width.px': 48, 'height.px': 48, color: 'var(--success-500)' }">
        </app-svg>
        <app-typography
          [variant]="TypographyTypeEnum['h6-semibold']"
          color="var(--slate-800)">
          {{ 'confirmPresence.allDone' | translate }}
        </app-typography>
        <app-typography
          [variant]="TypographyTypeEnum['body-regular']"
          color="var(--slate-500)">
          {{ 'confirmPresence.noPending' | translate }}
        </app-typography>
        <app-button
          [block]="true"
          [style]="ButtonStyleEnum.primary"
          [text]="'confirmPresence.goToDashboard' | translate"
          (buttonClick)="goToHome()">
        </app-button>
      </div>
    } @else {
      <div class="appointments-section">
        <app-typography
          [variant]="TypographyTypeEnum['h6-semibold']"
          color="var(--slate-800)">
          {{ 'confirmPresence.title' | translate }}
        </app-typography>
        <app-typography
          [variant]="TypographyTypeEnum['body-regular']"
          color="var(--slate-500)">
          {{ 'confirmPresence.subtitle' | translate }}
        </app-typography>

        @for (appointment of pendingAppointments; track appointment.id) {
          <div class="appointment-card">
            <div class="appointment-info">
              <div class="info-row">
                <app-svg
                  [src]="appointment.type === AppointmentType.ONLINE ? 'video' : 'calendar'"
                  [svgStyle]="{ 'width.px': 18, 'height.px': 18, color: 'var(--slate-500)' }">
                </app-svg>
                <app-typography
                  [variant]="TypographyTypeEnum['body-s-medium']"
                  color="var(--slate-700)">
                  {{ appointment.type === AppointmentType.ONLINE ? ('confirmPresence.videoConsultation' | translate) : ('confirmPresence.inPersonVisit' | translate) }}
                </app-typography>
              </div>
              <div class="info-row">
                <app-svg
                  src="calendar"
                  [svgStyle]="{ 'width.px': 18, 'height.px': 18, color: 'var(--slate-500)' }">
                </app-svg>
                <app-typography
                  [variant]="TypographyTypeEnum['body-s-regular']"
                  color="var(--slate-600)">
                  {{ appointment.scheduled_at | localDate : 'MMM d, y, HH:mm' }}
                </app-typography>
              </div>
              <div class="info-row">
                <app-svg
                  src="user"
                  [svgStyle]="{ 'width.px': 18, 'height.px': 18, color: 'var(--slate-500)' }">
                </app-svg>
                <app-typography
                  [variant]="TypographyTypeEnum['body-s-regular']"
                  color="var(--slate-600)">
                  {{ appointment.doctorName }}
                </app-typography>
              </div>
            </div>

            <div class="appointment-actions">
              <app-button
                [block]="true"
                [size]="ButtonSizeEnum.medium"
                [style]="ButtonStyleEnum.stroke"
                [state]="ButtonStateEnum.error"
                [text]="'confirmPresence.decline' | translate"
                leftIcon="close"
                [disabled]="appointment.isConfirming || appointment.isDeclining"
                [loading]="appointment.isDeclining"
                (buttonClick)="declinePresence(appointment)">
              </app-button>
              <app-button
                [block]="true"
                [size]="ButtonSizeEnum.medium"
                [style]="ButtonStyleEnum.primary"
                [text]="'confirmPresence.confirm' | translate"
                leftIcon="check"
                [disabled]="appointment.isConfirming || appointment.isDeclining"
                [loading]="appointment.isConfirming"
                (buttonClick)="confirmPresence(appointment)">
              </app-button>
            </div>
          </div>
        }

        <div class="skip-link">
          <app-button
            [size]="ButtonSizeEnum.small"
            [style]="ButtonStyleEnum.text"
            [text]="'confirmPresence.skip' | translate"
            (buttonClick)="goToHome()">
          </app-button>
        </div>
      </div>
    }
  </div>
</div>

<app-page>
  <div class="appointments-container">
    <div class="calendar-header">
      <span class="total-count">{{ 'appointments.appointmentsCount' | translate:{ count: appointments().length } }}</span>
      <div class="header-controls">
        <div class="nav-controls">
          <button class="nav-btn" (click)="navigatePrev()">
            <span class="nav-icon">&lt;</span>
          </button>
          <button class="today-btn" (click)="goToToday()">{{ 'appointments.today' | translate }}</button>
          <button class="nav-btn" (click)="navigateNext()">
            <span class="nav-icon">&gt;</span>
          </button>
          <span class="current-date">{{ currentTitle() }}</span>
        </div>

        <div class="view-toggle">
          <button
            class="view-btn"
            [class.active]="isActiveView('list')"
            (click)="setView('list')">
            {{ 'appointments.list' | translate }}
          </button>
          <button
            class="view-btn"
            [class.active]="isActiveView('timeGridDay')"
            (click)="setView('timeGridDay')">
            {{ 'appointments.day' | translate }}
          </button>
          <button
            class="view-btn"
            [class.active]="isActiveView('timeGridWeek')"
            (click)="setView('timeGridWeek')">
            {{ 'appointments.week' | translate }}
          </button>
          <button
            class="view-btn"
            [class.active]="isActiveView('dayGridMonth')"
            (click)="setView('dayGridMonth')">
            {{ 'appointments.month' | translate }}
          </button>
        </div>
      </div>
    </div>

    @if (loading()) {
    <div class="loading-state">
      <app-loader></app-loader>
    </div>
    } @if (!loading() && currentView() === 'list') {
    <div class="list-view">
      @if (appointments().length === 0) {
      <div class="empty-state">
        <app-svg
          src="calendar"
          [svgStyle]="{'width.px': 48, 'height.px': 48}"></app-svg>
        <span>{{ 'appointments.noAppointmentsFound' | translate }}</span>
      </div>
      } @else { @for (appointment of appointments(); track appointment.id) {
      <div class="appointment-item" (click)="viewAppointment(appointment)">
        <div class="appointment-date">
          <span class="day">{{ appointment.scheduled_at | localDate:'dd' }}</span>
          <span class="month">{{ appointment.scheduled_at | localDate:'MMM' }}</span>
        </div>
        <div class="appointment-info">
          <div class="appointment-title">
            {{ getAppointmentTypeLabel(appointment.type) }}
          </div>
          <div class="appointment-meta">
            <span>
              <app-svg
                src="clock"
                [svgStyle]="{'width.px': 14, 'height.px': 14}"></app-svg>
              {{ appointment.scheduled_at | localDate:'HH:mm' }} @if
              (appointment.end_expected_at) { - {{ appointment.end_expected_at |
              localDate:'HH:mm' }} }
            </span>
            @if (appointment.created_by) {
            <span>
              <app-svg
                src="user"
                [svgStyle]="{'width.px': 14, 'height.px': 14}"></app-svg>
              {{ appointment.created_by.first_name }} {{
              appointment.created_by.last_name }}
            </span>
            }
          </div>
        </div>
        <div class="appointment-status">
          <app-badge [type]="getAppointmentBadgeType(appointment.status)">
            {{ getAppointmentStatusLabel(appointment.status) }}
          </app-badge>
        </div>
      </div>
      } } @if (hasMore()) {
      <div class="load-more-container">
        <app-button
          [text]="'appointments.viewMore' | translate"
          [style]="ButtonStyleEnum.text"
          [size]="ButtonSizeEnum.medium"
          [loading]="loadingMore()"
          [disabled]="loadingMore()"
          (buttonClick)="loadMore()">
        </app-button>
      </div>
      }
    </div>
    }

    <div
      class="calendar-wrapper"
      [style.display]="loading() || currentView() === 'list' ? 'none' : 'block'">
      <full-calendar
        #calendar
        [options]="calendarOptions"
        [events]="calendarEvents()">
      </full-calendar>
    </div>

    @if (hoveredAppointment()) {
    <div
      class="calendar-tooltip"
      [style.top.px]="tooltipPosition().top"
      [style.left.px]="tooltipPosition().left">
      <div class="tooltip-header">
        <span
          class="tooltip-type"
          [class.online]="hoveredAppointment()!.type === AppointmentType.ONLINE">
          {{ getAppointmentTypeLabel(hoveredAppointment()!.type) }}
        </span>
        <span
          class="tooltip-status"
          [style.color]="getStatusColor(hoveredAppointment()!.status)">
          {{ getAppointmentStatusLabel(hoveredAppointment()!.status) }}
        </span>
      </div>

      <div class="tooltip-datetime">
        <app-svg
          src="calendar"
          [svgStyle]="{'width.px': 14, 'height.px': 14}"></app-svg>
        <span
          >{{ hoveredAppointment()!.scheduled_at | localDate : 'EEEE, MMM d, y'
          }}</span
        >
      </div>

      <div class="tooltip-time">
        <app-svg
          src="clock"
          [svgStyle]="{'width.px': 14, 'height.px': 14}"></app-svg>
        <span>
          {{ hoveredAppointment()!.scheduled_at | localDate : 'HH:mm' }} @if
          (hoveredAppointment()!.end_expected_at) { - {{
          hoveredAppointment()!.end_expected_at | localDate : 'HH:mm' }} }
        </span>
      </div>

      @if (hoveredAppointment()!.participants &&
      hoveredAppointment()!.participants.length > 0) {
      <div class="tooltip-participants">
        <span class="participants-title"
          >{{ 'appointments.participantsCount' | translate:{ count: hoveredAppointment()!.participants.length } }}</span
        >
        <div class="participants-list">
          @for (participant of hoveredAppointment()!.participants; track
          participant.id) {
          <div class="participant-row">
            <span class="participant-name"
              >{{ getParticipantName(participant) }}</span
            >
            <span
              class="participant-status"
              [style.color]="getParticipantStatusColor(participant.status)">
              {{ getParticipantStatusLabel(participant.status) }}
            </span>
          </div>
          }
        </div>
      </div>
      } @else {
      <div class="tooltip-no-participants">
        <span>{{ 'appointments.noParticipantsAdded' | translate }}</span>
      </div>
      }
    </div>
    }
  </div>
</app-page>

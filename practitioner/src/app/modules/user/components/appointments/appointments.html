<app-page>
  <div class="appointments-container">
    <div class="calendar-header">
      <span class="total-count">{{ appointments().length }} appointments</span>
      <div class="header-controls">
        <div class="nav-controls">
          <button class="nav-btn" (click)="navigatePrev()">
            <span class="nav-icon">&lt;</span>
          </button>
          <button class="today-btn" (click)="goToToday()">Today</button>
          <button class="nav-btn" (click)="navigateNext()">
            <span class="nav-icon">&gt;</span>
          </button>
          <span class="current-date">{{ currentTitle() }}</span>
        </div>

        <div class="view-toggle">
          <button
            class="view-btn"
            [class.active]="isActiveView('list')"
            (click)="setView('list')">
            List
          </button>
          <button
            class="view-btn"
            [class.active]="isActiveView('timeGridDay')"
            (click)="setView('timeGridDay')">
            Day
          </button>
          <button
            class="view-btn"
            [class.active]="isActiveView('timeGridWeek')"
            (click)="setView('timeGridWeek')">
            Week
          </button>
          <button
            class="view-btn"
            [class.active]="isActiveView('dayGridMonth')"
            (click)="setView('dayGridMonth')">
            Month
          </button>
        </div>
      </div>
    </div>

    @if (loading()) {
      <div class="loading-state">
        <app-loader></app-loader>
      </div>
    } @else if (currentView() === 'list') {
      <div class="list-view">
        @if (appointments().length === 0) {
          <div class="empty-state">
            <app-svg src="calendar" [svgStyle]="{'width.px': 48, 'height.px': 48}"></app-svg>
            <span>No appointments found</span>
          </div>
        } @else {
          @for (appointment of appointments(); track appointment.id) {
            <div class="appointment-item" (click)="viewAppointment(appointment)">
              <div class="appointment-date">
                <span class="day">{{ appointment.scheduled_at | date:'dd' }}</span>
                <span class="month">{{ appointment.scheduled_at | date:'MMM' }}</span>
              </div>
              <div class="appointment-info">
                <div class="appointment-title">{{ getAppointmentTypeLabel(appointment.type) }}</div>
                <div class="appointment-meta">
                  <span>
                    <app-svg src="clock" [svgStyle]="{'width.px': 14, 'height.px': 14}"></app-svg>
                    {{ appointment.scheduled_at | date:'HH:mm' }}
                    @if (appointment.end_expected_at) {
                      - {{ appointment.end_expected_at | date:'HH:mm' }}
                    }
                  </span>
                  @if (appointment.created_by) {
                    <span>
                      <app-svg src="user" [svgStyle]="{'width.px': 14, 'height.px': 14}"></app-svg>
                      {{ appointment.created_by.first_name }} {{ appointment.created_by.last_name }}
                    </span>
                  }
                </div>
              </div>
              <div class="appointment-status">
                <app-badge [type]="getAppointmentBadgeType(appointment.status)">
                  {{ appointment.status }}
                </app-badge>
              </div>
            </div>
          }
        }
      </div>
    } @else {
      <div class="calendar-wrapper">
        <full-calendar
          #calendar
          [options]="calendarOptions"
          [events]="calendarEvents()">
        </full-calendar>
      </div>
    }

    <div class="legend">
      <div class="legend-item">
        <span class="legend-color scheduled"></span>
        <span class="legend-label">Scheduled</span>
      </div>
      <div class="legend-item">
        <span class="legend-color in-progress"></span>
        <span class="legend-label">In Progress</span>
      </div>
      <div class="legend-item">
        <span class="legend-color completed"></span>
        <span class="legend-label">Completed</span>
      </div>
      <div class="legend-item">
        <span class="legend-color cancelled"></span>
        <span class="legend-label">Cancelled</span>
      </div>
    </div>
  </div>
</app-page>

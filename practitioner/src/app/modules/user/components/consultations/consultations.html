<app-page>
  <div class="consultations-container">
    <div class="consultations-header">
      <div class="header-content">
        <div class="title-section">
          <app-typography [variant]="TypographyTypeEnum['h2-semibold']">
            My Consultations
          </app-typography>
          <app-typography [variant]="TypographyTypeEnum['body-regular']" color="var(--slate-500)">
            Manage and track your patient consultations
          </app-typography>
        </div>
        <app-button
          text="New Consultation"
          leftIcon="plus"
          [size]="ButtonSizeEnum.medium"
          [style]="ButtonStyleEnum.primary"
          (buttonClick)="createConsultation()">
        </app-button>
      </div>

      <app-tabs
        [tabs]="tabItems"
        [activeTab]="activeTab()"
        (tabChange)="setActiveTab($event)">
      </app-tabs>
    </div>

    <div class="consultations-content">
      @if (loading()) {
        <div class="loading-state">
          <app-loader></app-loader>
          <app-typography [variant]="TypographyTypeEnum['body-regular']" color="var(--slate-500)">
            Loading consultations...
          </app-typography>
        </div>
      } @else if (error()) {
        <div class="error-state">
          <app-svg src="alert-circle"
                   [svgStyle]="{'width.px': 48, 'height.px': 48, 'color': 'var(--rose-500)'}"></app-svg>
          <app-typography [variant]="TypographyTypeEnum['body-l-medium']" color="var(--rose-500)">
            {{ error() }}
          </app-typography>
          <app-button
            text="Retry"
            [size]="ButtonSizeEnum.medium"
            [style]="ButtonStyleEnum.stroke"
            (click)="retryLoadConsultations()">
          </app-button>
        </div>
      } @else if (activeTab() === 'active') {
        <div class="consultations-grid">
          @for (consultation of activeConsultations; track consultation.id) {
            <div class="consultation-card">
              <div class="card-header">
                <div class="header-left">
                  <app-typography [variant]="TypographyTypeEnum['body-l-semibold']">
                    {{ consultation.title || 'Untitled Consultation' }}
                  </app-typography>
                  <app-badge [type]="BadgeTypeEnum.green">
                    Active
                  </app-badge>
                </div>
                <div class="card-actions">
                  <app-button
                    text="Edit"
                    leftIcon="edit"
                    [size]="ButtonSizeEnum.small"
                    [style]="ButtonStyleEnum.text"
                    (buttonClick)="editConsultation(consultation)">
                  </app-button>
                  <app-button
                    text="View Details"
                    leftIcon="arrow-right"
                    [size]="ButtonSizeEnum.small"
                    [style]="ButtonStyleEnum.primary"
                    (buttonClick)="viewConsultationDetails(consultation)">
                  </app-button>
                </div>
              </div>

              <div class="card-body">
                @if (consultation.description) {
                  <div class="description">
                    <app-typography [variant]="TypographyTypeEnum['body-s-regular']" color="var(--slate-500)">
                      {{ consultation.description }}
                    </app-typography>
                  </div>
                }

                <div class="consultation-info">
                  <div class="info-row">
                    <div class="info-item">
                      <app-svg src="user" [svgStyle]="{'width.px': 16, 'height.px': 16, 'color': 'var(--slate-400)'}"></app-svg>
                      <div class="info-content">
                        <app-typography [variant]="TypographyTypeEnum['body-xs-medium']" color="var(--slate-500)">
                          Patient
                        </app-typography>
                        <app-typography [variant]="TypographyTypeEnum['body-s-medium']">
                          {{ getBeneficiaryName(consultation) }}
                        </app-typography>
                      </div>
                    </div>

                    @if (consultation.group) {
                      <div class="info-item">
                        <app-svg src="users" [svgStyle]="{'width.px': 16, 'height.px': 16, 'color': 'var(--slate-400)'}"></app-svg>
                        <div class="info-content">
                          <app-typography [variant]="TypographyTypeEnum['body-xs-medium']" color="var(--slate-500)">
                            Team
                          </app-typography>
                          <app-typography [variant]="TypographyTypeEnum['body-s-medium']">
                            {{ consultation.group.name }}
                          </app-typography>
                        </div>
                      </div>
                    }
                  </div>

                  <div class="info-row">
                    <div class="info-item">
                      <app-svg src="user-check" [svgStyle]="{'width.px': 16, 'height.px': 16, 'color': 'var(--slate-400)'}"></app-svg>
                      <div class="info-content">
                        <app-typography [variant]="TypographyTypeEnum['body-xs-medium']" color="var(--slate-500)">
                          Assigned To
                        </app-typography>
                        <app-typography [variant]="TypographyTypeEnum['body-s-medium']">
                          {{ getOwnerName(consultation) }}
                        </app-typography>
                      </div>
                    </div>

                    <div class="info-item">
                      <app-svg src="calendar" [svgStyle]="{'width.px': 16, 'height.px': 16, 'color': 'var(--slate-400)'}"></app-svg>
                      <div class="info-content">
                        <app-typography [variant]="TypographyTypeEnum['body-xs-medium']" color="var(--slate-500)">
                          Created
                        </app-typography>
                        <app-typography [variant]="TypographyTypeEnum['body-s-medium']">
                          {{ formatDate(consultation.created_at) }}
                        </app-typography>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          } @empty {
            <div class="empty-state">
              <app-svg src="calendar" [svgStyle]="{'width.px': 48, 'height.px': 48, 'opacity': 0.3}"></app-svg>
              <app-typography [variant]="TypographyTypeEnum['body-l-medium']" color="var(--slate-400)">
                No active consultations
              </app-typography>
              <app-typography [variant]="TypographyTypeEnum['body-regular']" color="var(--slate-500)">
                Your active consultations will appear here
              </app-typography>
            </div>
          }
        </div>
      } @else {
        <div class="consultations-grid">
          @for (consultation of pastConsultations; track consultation.id) {
            <div class="consultation-card past-card">
              <div class="card-header">
                <div class="header-left">
                  <app-typography [variant]="TypographyTypeEnum['body-l-semibold']">
                    {{ consultation.title || 'Untitled Consultation' }}
                  </app-typography>
                  <app-badge [type]="BadgeTypeEnum.gray">
                    Closed
                  </app-badge>
                </div>
                <div class="card-actions">
                  <app-button
                    text="View Details"
                    leftIcon="report"
                    [size]="ButtonSizeEnum.small"
                    [style]="ButtonStyleEnum.stroke"
                    (buttonClick)="viewConsultationDetails(consultation)">
                  </app-button>
                </div>
              </div>

              <div class="card-body">
                @if (consultation.description) {
                  <div class="description">
                    <app-typography [variant]="TypographyTypeEnum['body-s-regular']" color="var(--slate-500)">
                      {{ consultation.description }}
                    </app-typography>
                  </div>
                }

                <div class="consultation-info">
                  <div class="info-row">
                    <div class="info-item">
                      <app-svg src="user" [svgStyle]="{'width.px': 16, 'height.px': 16, 'color': 'var(--slate-400)'}"></app-svg>
                      <div class="info-content">
                        <app-typography [variant]="TypographyTypeEnum['body-xs-medium']" color="var(--slate-500)">
                          Patient
                        </app-typography>
                        <app-typography [variant]="TypographyTypeEnum['body-s-medium']">
                          {{ getBeneficiaryName(consultation) }}
                        </app-typography>
                      </div>
                    </div>

                    @if (consultation.group) {
                      <div class="info-item">
                        <app-svg src="users" [svgStyle]="{'width.px': 16, 'height.px': 16, 'color': 'var(--slate-400)'}"></app-svg>
                        <div class="info-content">
                          <app-typography [variant]="TypographyTypeEnum['body-xs-medium']" color="var(--slate-500)">
                            Team
                          </app-typography>
                          <app-typography [variant]="TypographyTypeEnum['body-s-medium']">
                            {{ consultation.group.name }}
                          </app-typography>
                        </div>
                      </div>
                    }
                  </div>

                  <div class="info-row">
                    <div class="info-item">
                      <app-svg src="user-check" [svgStyle]="{'width.px': 16, 'height.px': 16, 'color': 'var(--slate-400)'}"></app-svg>
                      <div class="info-content">
                        <app-typography [variant]="TypographyTypeEnum['body-xs-medium']" color="var(--slate-500)">
                          Assigned To
                        </app-typography>
                        <app-typography [variant]="TypographyTypeEnum['body-s-medium']">
                          {{ getOwnerName(consultation) }}
                        </app-typography>
                      </div>
                    </div>

                    @if (consultation.closed_at) {
                      <div class="info-item">
                        <app-svg src="calendar" [svgStyle]="{'width.px': 16, 'height.px': 16, 'color': 'var(--slate-400)'}"></app-svg>
                        <div class="info-content">
                          <app-typography [variant]="TypographyTypeEnum['body-xs-medium']" color="var(--slate-500)">
                            Closed
                          </app-typography>
                          <app-typography [variant]="TypographyTypeEnum['body-s-medium']">
                            {{ formatDate(consultation.closed_at) }}
                          </app-typography>
                        </div>
                      </div>
                    }
                  </div>
                </div>
              </div>
            </div>
          } @empty {
            <div class="empty-state">
              <app-svg src="history" [svgStyle]="{'width.px': 48, 'height.px': 48, 'opacity': 0.3}"></app-svg>
              <app-typography [variant]="TypographyTypeEnum['body-l-medium']" color="var(--slate-400)">
                No past consultations
              </app-typography>
              <app-typography [variant]="TypographyTypeEnum['body-regular']" color="var(--slate-500)">
                Your completed consultations will appear here
              </app-typography>
            </div>
          }
        </div>
      }
    </div>
  </div>
</app-page>

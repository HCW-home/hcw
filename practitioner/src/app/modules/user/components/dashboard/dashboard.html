<app-page>
  <div class="dashboard-container">
    @if (loading()) {
      <div class="loading-state">
        <app-loader></app-loader>
        <app-typography [variant]="TypographyTypeEnum['body-regular']" color="var(--slate-500)">
          Loading dashboard...
        </app-typography>
      </div>
    } @else if (error()) {
      <div class="error-state">
        <app-svg src="error" [svgStyle]="{'width.px': 48, 'height.px': 48, 'color': 'var(--rose-500)'}"></app-svg>
        <app-typography [variant]="TypographyTypeEnum['body-l-medium']" color="var(--rose-500)">
          {{ error() }}
        </app-typography>
        <app-button
          text="Retry"
          [size]="ButtonSizeEnum.medium"
          [style]="ButtonStyleEnum.stroke"
          (buttonClick)="retry()">
        </app-button>
      </div>
    } @else {
      <div class="active-consultations-section">
        <div class="section-card">
          <div class="section-header">
            <div class="header-left">
              <div class="section-icon primary">
                <app-svg src="video" [svgStyle]="{'width.px': 20, 'height.px': 20, 'color': 'var(--primary-600)'}"></app-svg>
              </div>
              <div class="section-title">
                <app-typography [variant]="TypographyTypeEnum['body-l-bold']" color="var(--slate-800)">
                  Active Consultations
                </app-typography>
                <app-typography [variant]="TypographyTypeEnum['body-s-regular']" color="var(--slate-500)">
                  Currently ongoing sessions
                </app-typography>
              </div>
            </div>
          </div>
          <div class="section-content">
            @if (recentConsultations().length === 0) {
              <div class="empty-state-small">
                <app-svg src="video" [svgStyle]="{'width.px': 32, 'height.px': 32, 'opacity': 0.3}"></app-svg>
                <app-typography [variant]="TypographyTypeEnum['body-s-medium']" color="var(--slate-400)">
                  No active consultations
                </app-typography>
              </div>
            } @else {
              <div class="active-consultations-grid">
                @for (consultation of recentConsultations().slice(0, 4); track consultation.id) {
                  <div class="active-consultation-card" (click)="viewConsultation(consultation)">
                    <div class="consultation-header">
                      <div class="patient-avatar">
                        <span>{{ getBeneficiaryName(consultation).substring(0, 2).toUpperCase() }}</span>
                      </div>
                      <div class="patient-info">
                        <app-typography [variant]="TypographyTypeEnum['body-semibold']" color="var(--slate-800)">
                          {{ getBeneficiaryName(consultation) }}
                        </app-typography>
                        <div class="status-indicator">
                          <span class="status-dot"></span>
                          <app-typography [variant]="TypographyTypeEnum['body-s-medium']" color="var(--primary-600)">
                            {{ consultation.closed_at ? 'Closed' : 'Active' }}
                          </app-typography>
                        </div>
                      </div>
                    </div>
                    <div class="consultation-footer">
                      <div class="consultation-time">
                        <app-svg src="clock" [svgStyle]="{'width.px': 16, 'height.px': 16, 'color': 'var(--slate-400)'}"></app-svg>
                        <app-typography [variant]="TypographyTypeEnum['body-s-medium']" color="var(--slate-500)">
                          {{ formatDate(consultation.created_at) }}
                        </app-typography>
                      </div>
                      <button class="join-btn">
                        {{ consultation.closed_at ? 'View' : 'Join' }}
                      </button>
                    </div>
                  </div>
                }
              </div>
            }
          </div>
        </div>
      </div>

      <div class="dashboard-grid">
        <div class="main-content">
          <div class="section-card">
            <div class="section-header">
              <div class="header-left">
                <div class="section-icon primary">
                  <app-svg src="calendar" [svgStyle]="{'width.px': 20, 'height.px': 20, 'color': 'var(--primary-600)'}"></app-svg>
                </div>
                <div class="section-title">
                  <app-typography [variant]="TypographyTypeEnum['body-l-bold']" color="var(--slate-800)">
                    Upcoming Consultations
                  </app-typography>
                  <app-typography [variant]="TypographyTypeEnum['body-s-regular']" color="var(--slate-500)">
                    Your scheduled appointments
                  </app-typography>
                </div>
              </div>
              <app-button
                text="View all"
                rightIcon="chevron-right"
                [size]="ButtonSizeEnum.small"
                [style]="ButtonStyleEnum.text"
                (buttonClick)="navigateToConsultations()">
              </app-button>
            </div>
            <div class="section-content">
              @if (upcomingAppointments().length === 0) {
                <div class="empty-state-small">
                  <app-svg src="calendar" [svgStyle]="{'width.px': 32, 'height.px': 32, 'opacity': 0.3}"></app-svg>
                  <app-typography [variant]="TypographyTypeEnum['body-s-medium']" color="var(--slate-400)">
                    No upcoming appointments
                  </app-typography>
                </div>
              } @else {
                <div class="appointments-list">
                  @for (item of upcomingAppointments(); track item.appointment.id) {
                    <div class="appointment-item" (click)="viewAppointment(item)">
                      <div class="patient-avatar small">
                        <span>{{ getBeneficiaryName(item.consultation).substring(0, 2).toUpperCase() }}</span>
                      </div>
                      <div class="appointment-details">
                        <app-typography [variant]="TypographyTypeEnum['body-semibold']" color="var(--slate-800)">
                          {{ getBeneficiaryName(item.consultation) }}
                        </app-typography>
                        <app-typography [variant]="TypographyTypeEnum['body-s-regular']" color="var(--slate-500)">
                          {{ item.consultation.title || 'Consultation' }}
                        </app-typography>
                      </div>
                      <div class="appointment-time">
                        <app-typography [variant]="TypographyTypeEnum['body-semibold']" color="var(--slate-800)">
                          {{ formatDateTime(item.appointment.scheduled_at).split(',')[1] }}
                        </app-typography>
                        <app-typography [variant]="TypographyTypeEnum['body-s-regular']" color="var(--slate-500)">
                          {{ getRelativeTime(item.appointment.scheduled_at) }}
                        </app-typography>
                      </div>
                      <button class="video-btn">
                        <app-svg src="video" [svgStyle]="{'width.px': 20, 'height.px': 20, 'color': 'var(--White)'}"></app-svg>
                      </button>
                    </div>
                  }
                </div>
              }
            </div>
          </div>
        </div>

        <div class="sidebar-content">
          <div class="section-card quick-actions">
            <div class="section-header">
              <div class="header-left">
                <div class="section-icon amber">
                  <app-svg src="activity-history" [svgStyle]="{'width.px': 20, 'height.px': 20, 'color': 'var(--amber-600)'}"></app-svg>
                </div>
                <div class="section-title">
                  <app-typography [variant]="TypographyTypeEnum['body-l-bold']" color="var(--slate-800)">
                    Quick Actions
                  </app-typography>
                  <app-typography [variant]="TypographyTypeEnum['body-s-regular']" color="var(--slate-500)">
                    Frequently used features
                  </app-typography>
                </div>
              </div>
            </div>
            <div class="section-content">
              <div class="quick-actions-grid">
                <button class="quick-action-btn" (click)="navigateToNewConsultation()">
                  <div class="action-icon primary">
                    <app-svg src="plus" [svgStyle]="{'width.px': 24, 'height.px': 24, 'color': 'var(--White)'}"></app-svg>
                  </div>
                  <app-typography [variant]="TypographyTypeEnum['body-s-medium']" color="var(--slate-700)">
                    New Consultation
                  </app-typography>
                </button>
                <button class="quick-action-btn" (click)="navigateToAvailability()">
                  <div class="action-icon green">
                    <app-svg src="calendar" [svgStyle]="{'width.px': 24, 'height.px': 24, 'color': 'var(--White)'}"></app-svg>
                  </div>
                  <app-typography [variant]="TypographyTypeEnum['body-s-medium']" color="var(--slate-700)">
                    Availability
                  </app-typography>
                </button>
                <button class="quick-action-btn" (click)="navigateToSystemTest()">
                  <div class="action-icon amber">
                    <app-svg src="video" [svgStyle]="{'width.px': 24, 'height.px': 24, 'color': 'var(--White)'}"></app-svg>
                  </div>
                  <app-typography [variant]="TypographyTypeEnum['body-s-medium']" color="var(--slate-700)">
                    System Test
                  </app-typography>
                </button>
                <button class="quick-action-btn" (click)="navigateToConsultations()">
                  <div class="action-icon gray">
                    <app-svg src="report" [svgStyle]="{'width.px': 24, 'height.px': 24, 'color': 'var(--White)'}"></app-svg>
                  </div>
                  <app-typography [variant]="TypographyTypeEnum['body-s-medium']" color="var(--slate-700)">
                    All Consultations
                  </app-typography>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    }
  </div>
</app-page>

<app-page>
  <div class="patients-container">
    <div class="page-header">
      <app-typography [variant]="TypographyTypeEnum['body-s-regular']" color="var(--slate-500)">
        {{ totalCount() }} total patients
      </app-typography>
      <div class="header-actions">
        <div class="search-wrapper">
          <app-input
            placeholder="Search patients..."
            leftIcon="search"
            [ngModel]="searchQuery"
            (ngModelChange)="onSearchChange($event)">
          </app-input>
        </div>
        <app-button
          text="Add Patient"
          leftIcon="plus"
          [style]="ButtonStyleEnum.primary"
          [size]="ButtonSizeEnum.medium"
          (buttonClick)="openAddModal()">
        </app-button>
      </div>
    </div>

    <div class="patients-card">
      <div class="table-header">
        <div class="header-cell patient-col">Patient</div>
        <div class="header-cell contact-col">Contact</div>
        <div class="header-cell status-col">Status</div>
        <div class="header-cell action-col"></div>
      </div>

      <div class="table-body">
        @if (loading()) {
          <div class="loading-state">
            <app-loader></app-loader>
          </div>
        } @else if (patients().length === 0) {
          <div class="empty-state">
            <app-svg src="user" [svgStyle]="{'width.px': 48, 'height.px': 48, 'color': 'var(--slate-300)'}"></app-svg>
            <app-typography [variant]="TypographyTypeEnum['body-l-medium']" color="var(--slate-600)">
              No patients found
            </app-typography>
            <app-typography [variant]="TypographyTypeEnum['body-s-regular']" color="var(--slate-400)">
              @if (searchQuery) {
                Try a different search term
              } @else {
                Add your first patient to get started
              }
            </app-typography>
          </div>
        } @else {
          @for (patient of patients(); track patient.pk) {
            <div class="table-row" (click)="viewPatient(patient)">
              <div class="row-cell patient-col">
                <div class="patient-avatar">
                  {{ getInitials(patient) }}
                </div>
                <div class="patient-info">
                  <app-typography [variant]="TypographyTypeEnum['body-semibold']" color="var(--slate-800)">
                    {{ getFullName(patient) }}
                  </app-typography>
                </div>
              </div>

              <div class="row-cell contact-col">
                <div class="contact-item">
                  <app-svg src="email" [svgStyle]="{'width.px': 14, 'height.px': 14, 'color': 'var(--slate-400)'}"></app-svg>
                  <span class="contact-text">{{ patient.email }}</span>
                </div>
                @if (patient.mobile_phone_number) {
                  <div class="contact-item">
                    <app-svg src="phone" [svgStyle]="{'width.px': 14, 'height.px': 14, 'color': 'var(--slate-400)'}"></app-svg>
                    <span class="contact-text">{{ patient.mobile_phone_number }}</span>
                  </div>
                }
              </div>

              <div class="row-cell status-col">
                <span class="status-badge" [class.online]="patient.is_online">
                  {{ patient.is_online ? 'Online' : 'Offline' }}
                </span>
              </div>

              <div class="row-cell action-col">
                <div class="row-action">
                  <app-svg src="arrow-right" [svgStyle]="{'width.px': 20, 'height.px': 20, 'color': 'var(--slate-400)'}"></app-svg>
                </div>
              </div>
            </div>
          }
        }
      </div>
    </div>
  </div>

  <app-modal
    [isOpen]="showAddModal()"
    size="large"
    [showCloseButton]="false"
    (closed)="closeAddModal()">
    <app-add-edit-patient
      [patient]="null"
      (saved)="onPatientCreated()"
      (cancelled)="closeAddModal()">
    </app-add-edit-patient>
  </app-modal>
</app-page>

<div class="select-wrapper">
  @if (label()) {
    <label class="input-label" [for]="name()">
      {{ label() }}
      @if (required()) {
        <span class="required-indicator">*</span>
      }
    </label>
  }

  <select [id]="name()" class="native-select" [disabled]="disabled" autocomplete="off" [value]="value">
    @for (opt of options(); track opt.value) {
      <option [value]="opt.value" [disabled]="opt.disabled">
        {{ opt.label }}
      </option>
    }
  </select>

  <div
    class="select-container"
    role="button"
    aria-disabled="true"
    [class.has-value]="display"
    [class.invalid]="invalid() && !open"
    [class.disabled]="disabled"
    [attr.aria-disabled]="disabled"
    (keydown.tab)="toggleDropdown()"
    (click)="$event.stopPropagation(); toggleDropdown()">
    @if (multiSelect() && selectedValues.length > 0) {
      <div class="selected-tags">
        @for (item of selectedValues; track item.value) {
          <span class="tag">
            {{ item.label }}
            <button type="button" (click)="removeSelected(item)">Ã—</button>
          </span>
        }
      </div>
    }

    <div class="select-display">
      <input
        [id]="'select-search' + name()"
        type="text"
        class="select-search"
        [readonly]="!open"
        [disabled]="disabled"
        [value]="searchInputValue()"
        [placeholder]="
          multiSelect() && selectedValues.length ? '' : placeholder()
        "
        (input)="onSearchInput($event)"
        (click)="$event.stopPropagation(); open = true" />
    </div>

    @if (clearable() && display && !disabled) {
      <button
        type="button"
        class="select-clear"
        (click)="clearValue($event)">
        <app-svg
          src="close"
          [svgStyle]="{ 'width.px': 14, 'height.px': 14, 'fill': 'var(--slate-500)' }">
        </app-svg>
      </button>
    }

    <div class="select-arrow">
      <app-svg
        src="svg/select-arrow.svg"
        [svgStyle]="{
          fill:
            display || selectedValues.length
              ? 'var(--slate-800)'
              : 'var(--slate-500)',
        }"></app-svg>
    </div>

    @if (open) {
      <ul class="options">
        @for (opt of filteredOptions; track opt.value; let i = $index) {
          <li
            tabindex="0"
            role="listitem"
            class="option"
            [class.selected]="isSelected(opt)"
            [class.disabled]="opt.disabled"
            [class.new-option]="opt.isNew"
            [class.hover]="hoverIndex === i"
            (click)="onOptionClick(opt); $event.stopPropagation()"
            (mouseenter)="hoverIndex = i"
            (mouseleave)="hoverIndex = null"
            (keydown.enter)="onOptionClick(opt); $event.stopPropagation()">
            <app-typography
              class="select-value"
              [variant]="TypographyTypeEnum['body-medium']">
              {{ opt.label }}
            </app-typography>
          </li>
        }
      </ul>
    }
  </div>

  @if (invalidMessage() && invalid() && !open) {
    <app-error-message [message]="invalidMessage()"></app-error-message>
  }
</div>

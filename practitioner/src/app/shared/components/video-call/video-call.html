<div class="video-call-container">
  @if (error) {
    <div class="error-banner">
      <app-typography [variant]="TypographyTypeEnum['body-regular']">
        {{ error }}
      </app-typography>
    </div>
  }

  <div class="video-grid">
    <div class="local-video-wrapper">
      <video #localVideo class="local-video" autoplay playsinline></video>
      <div class="video-overlay">
        <app-typography [variant]="TypographyTypeEnum['body-s-semibold']" class="participant-name">
          {{ displayName }} (You)
        </app-typography>
      </div>
      @if (!isVideoEnabled) {
        <div class="video-disabled-overlay">
          <app-svg src="camera-off" class="disabled-icon"></app-svg>
        </div>
      }
    </div>

    @if (remoteStreams.length > 0) {
      @for (remote of remoteStreams; track trackByFeedId($index, remote)) {
        <div class="remote-video-wrapper">
          <video
            [id]="'remote-video-' + remote.feedId"
            class="remote-video"
            autoplay
            playsinline>
          </video>
          <div class="video-overlay">
            <app-typography [variant]="TypographyTypeEnum['body-s-semibold']" class="participant-name">
              {{ remote.participant.display }}
            </app-typography>
          </div>
        </div>
      }
    } @else {
      <div class="waiting-wrapper">
        <div class="waiting-content">
          <app-svg src="users" class="waiting-icon"></app-svg>
          <app-typography [variant]="TypographyTypeEnum['h6-semibold']">
            Waiting for others to join...
          </app-typography>
          <app-typography [variant]="TypographyTypeEnum['body-regular']" class="waiting-text">
            Share the consultation link with participants
          </app-typography>
        </div>
      </div>
    }
  </div>

  <div class="call-controls">
    <app-button
      [size]="ButtonSizeEnum.large"
      [style]="ButtonStyleEnum.stroke"
      [state]="isAudioEnabled ? ButtonStateEnum.default : ButtonStateEnum.error"
      (click)="toggleAudio()"
      class="control-button">
      <app-svg [src]="isAudioEnabled ? 'microphone' : 'microphone-off'"></app-svg>
      {{ isAudioEnabled ? 'Mute' : 'Unmute' }}
    </app-button>

    <app-button
      [size]="ButtonSizeEnum.large"
      [style]="ButtonStyleEnum.stroke"
      [state]="isVideoEnabled ? ButtonStateEnum.default : ButtonStateEnum.error"
      (click)="toggleVideo()"
      class="control-button">
      <app-svg [src]="isVideoEnabled ? 'camera' : 'camera-off'"></app-svg>
      {{ isVideoEnabled ? 'Stop Video' : 'Start Video' }}
    </app-button>

    <app-button
      [size]="ButtonSizeEnum.large"
      [style]="ButtonStyleEnum.primary"
      [state]="ButtonStateEnum.error"
      (click)="endCall()"
      class="control-button end-call">
      <app-svg src="phone-off"></app-svg>
      End Call
    </app-button>
  </div>

  @if (!isPublishing) {
    <div class="connecting-overlay">
      <div class="connecting-content">
        <div class="spinner"></div>
        <app-typography [variant]="TypographyTypeEnum['h6-semibold']">
          Connecting...
        </app-typography>
      </div>
    </div>
  }
</div>

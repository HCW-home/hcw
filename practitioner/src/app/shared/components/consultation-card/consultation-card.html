<div class="consultation-card" [ngClass]="type() + '-card'">
  <div class="card-header">
    <div class="patient-info">
      <div class="patient-avatar">
        <app-svg src="svg/user.svg" [svgStyle]="{'width.px': 24, 'height.px': 24}"></app-svg>
      </div>
      <div class="patient-details">
        <app-typography [variant]="TypographyTypeEnum['body-l-semibold']">
          {{ consultation().patient_name }}
        </app-typography>
        @if (consultation().patient_age) {
          <app-typography [variant]="TypographyTypeEnum['body-s-regular']" color="var(--slate-500)">
            Age {{ consultation().patient_age }}
          </app-typography>
        } @else {
          <app-typography [variant]="TypographyTypeEnum['body-s-regular']" color="var(--slate-500)">
            {{ consultation().patient_email || 'No contact info' }}
          </app-typography>
        }
      </div>
    </div>
    <app-badge [type]="getStatusBadgeType(consultation().status)">
      {{ consultation().status }}
    </app-badge>
  </div>

  <div class="card-body">
    <div class="consultation-meta">
      <div class="meta-item">
        <app-svg [src]="getConsultationTypeIcon(consultation().consultation_type)"
                 [svgStyle]="{'width.px': 16, 'height.px': 16}"></app-svg>
        <app-typography [variant]="TypographyTypeEnum['body-s-regular']">
          {{ consultation().consultation_type | titlecase }}
        </app-typography>
      </div>
      <div class="meta-item">
        <app-svg src="calendar" [svgStyle]="{'width.px': 16, 'height.px': 16}"></app-svg>
        <app-typography [variant]="TypographyTypeEnum['body-s-regular']">
          @if (type() === 'active') {
            {{ consultation().date | date:'MMM dd, h:mm a' }}
          } @else {
            {{ consultation().date | date:'MMM dd, yyyy' }}
          }
        </app-typography>
      </div>
      <div class="meta-item">
        <app-svg src="clock" [svgStyle]="{'width.px': 16, 'height.px': 16}"></app-svg>
        <app-typography [variant]="TypographyTypeEnum['body-s-regular']">
          {{ consultation().duration }} min
        </app-typography>
      </div>
    </div>

    @if (type() === 'active' && consultation().symptoms && consultation().symptoms!.length > 0) {
      <div class="symptoms">
        <app-typography [variant]="TypographyTypeEnum['body-xs-medium']" color="var(--slate-500)">
          Symptoms:
        </app-typography>
        <div class="symptoms-tags">
          @for (symptom of consultation().symptoms; track symptom) {
            <span class="symptom-tag">{{ symptom }}</span>
          }
        </div>
      </div>
    }

    @if (type() === 'past' && consultation().notes) {
      <div class="consultation-notes">
        <app-typography [variant]="TypographyTypeEnum['body-xs-medium']" color="var(--slate-500)">
          Notes:
        </app-typography>
        <app-typography [variant]="TypographyTypeEnum['body-s-regular']">
          {{ consultation().notes }}
        </app-typography>
      </div>
    }

    @if (type() === 'past' && consultation().follow_up_required) {
      <div class="follow-up-indicator">
        <app-svg src="alert-circle" [svgStyle]="{'width.px': 16, 'height.px': 16, 'fill': 'var(--amber-500)'}"></app-svg>
        <app-typography [variant]="TypographyTypeEnum['body-xs-medium']" color="var(--amber-600)">
          Follow-up required
        </app-typography>
      </div>
    }
  </div>

  <div class="card-actions">
    <app-button
      text="View Details"
      [size]="ButtonSizeEnum.small"
      [style]="type() === 'active' ? ButtonStyleEnum.primary : ButtonStyleEnum.stroke"
      (buttonClick)="onViewDetails()">
    </app-button>
    @if (type() === 'past' && consultation().follow_up_required) {
      <app-button
        text="Schedule Follow-up"
        [size]="ButtonSizeEnum.small"
        [style]="ButtonStyleEnum.text"
        (buttonClick)="onScheduleFollowUp()">
      </app-button>
    }
  </div>
</div>

<app-header
  [pageTitle]="'appointmentDetail.title' | translate"
  [showBackButton]="true"
  backHref="/home"
></app-header>

<ion-content class="appointment-detail-content">
  @if (isLoading()) {
  <div class="loading-container">
    <ion-spinner name="crescent"></ion-spinner>
  </div>
  } @else if (appointment()) {
  <div class="main-content">
    <div class="appointment-header-section">
      <div class="header-top">
        <span
          class="status-badge status-{{ getStatusConfig(appointment()?.status).color }}"
        >
          {{ getStatusConfig(appointment()?.status).label }}
        </span>
        <span class="appointment-type-tag">
          <ion-icon [name]="getTypeIcon()"></ion-icon>
          {{ getTypeLabel() }}
        </span>
      </div>
      <div class="header-date">
        <ion-icon name="calendar-outline"></ion-icon>
        <span
          >{{ appointment()?.scheduled_at | date:'EEEE, MMM d, yyyy' }}</span
        >
      </div>
      <div class="header-time">
        <ion-icon name="time-outline"></ion-icon>
        <span>
          {{ appointment()?.scheduled_at | date:'HH:mm' }} @if
          (appointment()?.end_expected_at) { â€” {{ appointment()?.end_expected_at
          | date:'HH:mm' }} }
        </span>
      </div>
    </div>

    @if (doctorName()) {
    <div class="info-card doctor-card">
      <div class="card-header">
        <ion-icon name="person-outline" class="card-icon"></ion-icon>
        <h3 class="info-title">{{ 'appointmentDetail.handledBy' | translate }}</h3>
      </div>
      <div class="doctor-row">
        <div class="doctor-avatar">{{ doctorInitial() }}</div>
        <span class="doctor-name">{{ doctorName() }}</span>
      </div>
    </div>
    } @if (getParticipants().length > 0) {
    <div class="info-card participants-card">
      <div class="card-header">
        <ion-icon name="people-outline" class="card-icon"></ion-icon>
        <h3 class="info-title">{{ 'appointmentDetail.participants' | translate }}</h3>
      </div>
      @for (participant of getParticipants(); track participant.name) {
      <div class="participant-row">
        <div class="participant-avatar">
          {{ participant.name.charAt(0).toUpperCase() }}
        </div>
        <div class="participant-info">
          <span class="participant-name">{{ participant.name }}</span>
        </div>
      </div>
      }
    </div>
    } @if (isCancelled()) {
    <div class="info-card cancelled-card">
      <div class="card-header">
        <ion-icon name="close-circle-outline" class="card-icon"></ion-icon>
        <h3 class="info-title">{{ 'appointmentDetail.cancelled' | translate }}</h3>
      </div>
      <p class="cancelled-text">{{ 'appointmentDetail.cancelledText' | translate }}</p>
    </div>
    } @if (!isCancelled()) {
    <div class="actions-section">
      @if (isOnline()) {
      <button class="action-button primary-btn" (click)="joinVideoCall()">
        <ion-icon name="videocam-outline"></ion-icon>
        {{ 'appointmentDetail.joinVideoCall' | translate }}
      </button>
      } @if (appointment()?.consultation_id) {
      <button class="action-button secondary-btn" (click)="viewConsultation()">
        <ion-icon name="chatbubbles-outline"></ion-icon>
        {{ 'appointmentDetail.viewConsultation' | translate }}
      </button>
      }
    </div>
    }
  </div>
  } @else {
  <div class="empty-state">
    <ion-icon name="calendar-outline" class="empty-icon"></ion-icon>
    <p class="empty-text">{{ 'appointmentDetail.notFound' | translate }}</p>
  </div>
  }
</ion-content>

<app-footer></app-footer>

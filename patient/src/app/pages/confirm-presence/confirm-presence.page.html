<app-header [pageTitle]="'confirmPresence.title' | translate" [showBackButton]="true"></app-header>

<ion-content class="presence-content">
  <div class="presence-container">
    @if (isLoading) {
      <div class="loading-state">
        <ion-spinner name="crescent"></ion-spinner>
        <ion-text class="loading-text" color="medium">{{ 'confirmPresence.loadingAppointments' | translate }}</ion-text>
      </div>
    } @else if (errorMessage) {
      <div class="error-state">
        <ion-icon name="alert-circle-outline" class="error-icon"></ion-icon>
        <ion-text class="error-title" color="danger">{{ 'confirmPresence.error' | translate }}</ion-text>
        <ion-text class="error-message" color="medium">{{ errorMessage }}</ion-text>
        <ion-button expand="block" shape="round" (click)="goToHome()" class="action-button">
          {{ 'confirmPresence.goToHome' | translate }}
        </ion-button>
      </div>
    } @else if (pendingAppointments.length === 0) {
      <div class="empty-state">
        <ion-icon name="checkmark-circle-outline" class="success-icon"></ion-icon>
        <ion-text class="success-title">{{ 'confirmPresence.allDone' | translate }}</ion-text>
        <ion-text class="success-message" color="medium">
          {{ 'confirmPresence.noPending' | translate }}
        </ion-text>
        <ion-button expand="block" shape="round" (click)="goToHome()" class="action-button">
          {{ 'confirmPresence.goToHome' | translate }}
        </ion-button>
      </div>
    } @else {
      <div class="appointments-section">
        <ion-text class="section-subtitle" color="medium">
          {{ 'confirmPresence.pleaseConfirm' | translate }}
        </ion-text>

        @for (appointment of pendingAppointments; track appointment.id) {
          <ion-card class="appointment-card">
            <ion-card-content>
              <div class="appointment-info">
                <div class="appointment-type">
                  <ion-icon [name]="appointment.type === 'online' ? 'videocam-outline' : 'location-outline'"></ion-icon>
                  <span>{{ appointment.type === 'online' ? ('confirmPresence.online' | translate) : ('confirmPresence.inPerson' | translate) }}</span>
                </div>
                <div class="appointment-datetime">
                  <ion-icon name="calendar-outline"></ion-icon>
                  <span>{{ appointment.scheduled_at | localDate:'EEEE, MMM d' }} at {{ appointment.scheduled_at | localDate:'HH:mm' }}</span>
                </div>
              </div>

              <div class="appointment-actions">
                <ion-button
                  expand="block"
                  fill="outline"
                  shape="round"
                  color="danger"
                  [disabled]="appointment.isConfirming || appointment.isDeclining"
                  (click)="declinePresence(appointment)"
                  class="decline-button">
                  @if (appointment.isDeclining) {
                    <ion-spinner name="crescent"></ion-spinner>
                  } @else {
                    <ion-icon name="close-outline" slot="start"></ion-icon>
                    {{ 'confirmPresence.notAvailable' | translate }}
                  }
                </ion-button>
                <ion-button
                  expand="block"
                  shape="round"
                  [disabled]="appointment.isConfirming || appointment.isDeclining"
                  (click)="confirmPresence(appointment)"
                  class="confirm-button">
                  @if (appointment.isConfirming) {
                    <ion-spinner name="crescent"></ion-spinner>
                  } @else {
                    <ion-icon name="checkmark-outline" slot="start"></ion-icon>
                    {{ 'confirmPresence.available' | translate }}
                  }
                </ion-button>
              </div>
            </ion-card-content>
          </ion-card>
        }

        <div class="skip-link">
          <ion-text color="primary" (click)="goToHome()" class="link-text">
            {{ 'confirmPresence.skipToHome' | translate }}
          </ion-text>
        </div>
      </div>
    }
  </div>
</ion-content>

<app-footer></app-footer>
